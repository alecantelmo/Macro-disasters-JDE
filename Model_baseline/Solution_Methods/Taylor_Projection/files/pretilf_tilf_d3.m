function derivs=pretilf_tilf_d3(vars,params,index)
n_s=size(vars,1);
nl=vars(:,1);
logtilkstarbackp=vars(:,2);
logtilkstarback=vars(:,3);
d=vars(:,4);
logtheta=vars(:,5);
za=vars(:,6);
loghata=vars(:,7);
loghatz=vars(:,8);
l=vars(:,9);
logtilc=vars(:,10);
theta=vars(:,11);
logtilw=vars(:,12);
u4=vars(:,13);
tilc=vars(:,14);
tilx=vars(:,15);
logtilx=vars(:,16);
logtilk=vars(:,17);
u05=vars(:,18);
MUD=params(1);
RHOTHETA=params(2);
THETABAR=params(3);
SDV_THETA=params(4);
SDV_ZA=params(5);
ALPHA=params(6);
LAMBDA_A=params(7);
GAMMA=params(8);
NU=params(9);
PSI=params(10);
BETA=params(11);
DELTA=params(12);
PHI=params(13);
SCALEPARAM=params(14);
LOGTILUSS=params(15);
full_rows=zeros(8,1);
full_cols=zeros(8,3);
full_vals=zeros(n_s,8);
compressed_deriv=zeros(n_s,4);
compressed_deriv(:,1)=u05.*exp(logtilkstarbackp);
compressed_deriv(:,2)=exp(logtilkstarbackp);
compressed_deriv(:,3)=u05.*exp(logtilk).*(DELTA - 1);
compressed_deriv(:,4)=exp(logtilk).*(DELTA - 1);
uncompressed_deriv=compressed_deriv(:,index.nnz{1,3});
full_vals(:,1:8)=uncompressed_deriv;
full_cols(1:8,:)=index.loc{1,3};
full_rows(1:8)=1;
derivs=sptensor(full_rows,full_cols,full_vals,1,repmat(18,1,3));
